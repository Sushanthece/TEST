<!DOCTYPE html>

<head>

    <script type="text/javascript" src="js/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="js/jquery.tipsy.js"></script>
    <script type="text/javascript" src="js/d3.v3.min.js"></script>
    <script type="text/javascript" src="js/jquery.multiple.select.js"></script>
    <script type="text/javascript" src="js/underscore-min.js"></script>
    <script type="text/javascript" src="js/json2.js"></script>
    <script type="text/javascript" src="js/json2.js"></script>
    <script type="text/javascript" src="js/jspdf.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.js"></script>
    <script type="text/javascript" src="js/moment.min.js"></script>
    <script type="text/javascript" src="js/daterangepicker.js"></script>
    <script src="https://use.fontawesome.com/d14e495ffe.js"></script> 

    <link rel="stylesheet" type="text/css" media="screen" href="css/multiple-select.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/basic.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/feature.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/custom.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/multiple-select.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/jquery-ui.css" >
    <link rel="stylesheet" type="text/css" media="screen" href="css/tipsy.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/daterangepicker.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/font-awesome.css">

    <!-- Include Date Range Picker -->

    <link rel="icon" type="image/png" href="images/favicon.ico">
</head>

<body>
    <br /><br /><br /><br />
    <div class="container">
        <div class="row">
            <div class="tab">
                <button class="tablinks active" onclick="openCity(event, 'Attrition')">Employee Attrition By Period</button>
                <button class="tablinks" onclick="openCity(event, 'Recruitment')">Employee Recruitment By Designation Group</button>
                <button class="tablinks" onclick="openCity(event, 'DurationReport')">Employee Stay Duration</button>
            </div>

            <div id="Attrition" class="tabcontent">
                <div class="container-fluid detail_percent_display">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="chart">
                                    <div class="col-md-12 panel-body">
                                        <p class="form-inline header_form">
                                            <label value="input_date">Date Range:</label>
                                            <input type="text" name="daterange" class="dateRange" id="Attritiondatepicker" readonly />

                                            <label value="MaritalStatus">MaritalStatus: </label>
                                            <select multiple="multiple" id="AttritionMaritalStatus" class="MaritalStatus Attritionmultiple"></select>

                                            <label value="DesigGrp">DesigGrp: </label>
                                            <select multiple="multiple" id="AttritionDesigGrp" class="DesigGrp Attritionmultiple"></select>

                                            <label value="Groupby">Group By: </label>
                                            <select id="AttritionGroupby" class="select_Groupby"></select>

                                            <label value="Chartby">Chart : </label>
                                            <select id="AttritionChartby" class="select_Chart">
                                                <option value="multiLine" class="name" selected="">Multi Line Series</option>
                                                <option value="horizontalGroupBar" class="name" selected="">Horizontal Group Bar</option>
                                                <option value="groupBar" class="name" selected="">Group Bar</option>
                                                <option value="groupBarPlusLine" class="name" selected="">Group Bar Plus Line</option>
                                            </select>

                                            <input type="button" value="Submit" class="AttritionGroupby_options btn btn-default"></input>
                                            &nbsp;&nbsp;&nbsp;
                                            <button type="button" id="AttritionPDF" align="right" value="submit" class="fa fa-file-pdf-o icon-large"></button>
                                            <a id="AttritionCSV"><button id="AttritionBTN" class="fa fa-file-excel-o icon-large" aria-hidden="true"></button></a>
                                        </p>
                                        <hr class="linesep" />
                                        <div id="Attritionchart" style="height: 440px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="Recruitment" class="tabcontent">
                <div class="container-fluid detail_percent_display">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="chart">
                                    <div class="col-md-12 panel-body">
                                        <p class="form-inline header_form">
                                            <label value="input_date">Date Range:</label>
                                            <input type="text" name="daterange" class="dateRange" id="Recruitmentdatepicker" readonly />

                                            <label value="MaritalStatus">MaritalStatus: </label>
                                            <select multiple="multiple" id="RecruitmentMaritalStatus" class="MaritalStatus Recruitmentmultiple"></select>

                                            <label value="DesigGrp">DesigGrp: </label>
                                            <select multiple="multiple" id="RecruitmentDesigGrp" class="DesigGrp Recruitmentmultiple"></select>

                                            <label value="Groupby">Group By: </label>
                                            <select id="RecruitmentGroupby" class="select_Groupby"></select>

                                            <label value="Chartby">Chart : </label>
                                            <select id="RecruitmentChartby" class="select_Chart">
                                                <option value="multiLine" class="name" selected="">Multi Line Series</option>
                                                <option value="horizontalGroupBar" class="name" selected="">Horizontal Group Bar</option>
                                                <option value="groupBar" class="name" selected="">Group Bar</option>
                                                <option value="stackedBar" class="name" selected="">Stacked Bar</option>    
                                            </select>

                                            <input type="button" value="Submit" class="RecruitmentGroupby_options btn btn-default"></input>
                                            &nbsp;&nbsp;&nbsp;
                                            <button type="button" id="RecruitmentPDF" align="right" value="submit" class="fa fa-file-pdf-o icon-large"></button>
                                            <a id="RecruitmentCSV">
                                                <button id="RecruitmentBTN" class="fa fa-file-excel-o icon-large" aria-hidden="true"></button>
                                            </a>

                                        </p>
                                        <hr class="linesep" />
                                        <div id="Recruitmentchart" style="height: 440px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="DurationReport" class="tabcontent">
                <div class="container-fluid detail_percent_display">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="chart">
                                    <div class="col-md-12 panel-body">
                                        <p class="form-inline header_form">
                                            <label value="input_date">Date Range:</label>
                                            <input type="text" name="daterange" class="dateRange" id="DurationReportdatepicker" readonly />

                                            <label value="MaritalStatus">MaritalStatus: </label>
                                            <select multiple="multiple" id="DurationReportMaritalStatus" class="MaritalStatus DurationReportmultiple"></select>

                                            <label value="DesigGrp">DesigGrp: </label>
                                            <select multiple="multiple" id="DurationReportDesigGrp" class="DesigGrp DurationReportmultiple"></select>

                                            <label value="Groupby">Group By: </label>
                                            <select id="DurationReportGroupby" class="select_Groupby"></select>

                                            <label value="Chartby">Chart : </label>
                                            <select id="DurationReportChartby" class="select_Chart">
                                                <option value="multiLine" class="name" selected="">Multi Line Series</option>
                                                <option value="horizontalGroupBar" class="name" selected="">Horizontal Group Bar</option>
                                                <option value="groupBar" class="name" selected="">Group Bar</option>
                                                <option value="groupBarPlusLine" class="name" selected="">Group Bar Plus Line</option>
                                            </select>

                                            <input type="button" value="Submit" class="DurationReportGroupby_options btn btn-default"></input>
                                            &nbsp;&nbsp;&nbsp;
                                            <button type="button" id="DurationReportPDF" align="right" value="submit" class="fa fa-file-pdf-o icon-large"></button>
                                            <a id="DurationReportCSV"><button id="DurationReporttBTN" class="fa fa-file-excel-o icon-large" aria-hidden="true"></button></a>

                                        </p>
                                        <hr class="linesep" />
                                        <div id="DurationReportchart" style="height: 440px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function oJSONToCSVConvertor(JSONDataValue, Report_Name) {

            var JSONData = JSON.stringify(JSONDataValue)


            //If JSONData is not an object then JSON.parse will parse the JSON string in an Object
            var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;

            var CSV = '';
            //This condition will generate the Label/Header

            var row = "";

            if (arrData[0] != undefined) {

                if (arrData[0][0] == undefined) {
                    //This loop will extract the label from 1st index of on array
                    for (var index in arrData[0]) {
                        //Now convert each value to string and comma-seprated
                        row += index + ',';
                    }
                    row = row.slice(0, -1);
                    //append Label row with line break
                    CSV += row + '\r\n';


                    //1st loop is to extract each row
                    for (var i = 0; i < arrData.length; i++) {
                        var row = "";
                        //2nd loop will extract each column and convert it in string comma-seprated
                        for (var index in arrData[i]) {
                            row += '"' + arrData[i][index] + '",';
                        }
                        row.slice(0, row.length - 1);
                        //add a line break after each row
                        CSV += row + '\r\n';
                    }

                    if (CSV == '') {
                        alert("Invalid data");
                        return;
                    }

                    var csv = CSV;
                    blob = new Blob([csv], {
                        type: 'text/csv'
                    });
                    var csvUrl = window.URL.createObjectURL(blob);
                    var filename = 'Attrition.csv';

                    $("#AttritionCSV").attr({
                        'download': filename,
                        'href': csvUrl
                    });
                }

            }
        }


        function fJSONToCSVConvertor(JSONDataValue, Report_Name) {

            var JSONData = JSON.stringify(JSONDataValue)

            //If JSONData is not an object then JSON.parse will parse the JSON string in an Object
            var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;
            var CSV = '';
            //This condition will generate the Label/Header

            var row = "";

            if (arrData[0] != undefined) {

                if (arrData[0][0] == undefined) {
                    //This loop will extract the label from 1st index of on array
                    for (var index in arrData[0]) {
                        //Now convert each value to string and comma-seprated
                        row += index + ',';
                    }
                    row = row.slice(0, -1);
                    //append Label row with line break
                    CSV += row + '\r\n';


                    //1st loop is to extract each row
                    for (var i = 0; i < arrData.length; i++) {
                        var row = "";
                        //2nd loop will extract each column and convert it in string comma-seprated
                        for (var index in arrData[i]) {
                            row += '"' + arrData[i][index] + '",';
                        }
                        row.slice(0, row.length - 1);
                        //add a line break after each row
                        CSV += row + '\r\n';
                    }

                    if (CSV == '') {
                        alert("Invalid data");
                        return;
                    }

                    var csv = CSV;
                    blob = new Blob([csv], {
                        type: 'text/csv'
                    });
                    var csvUrl = window.URL.createObjectURL(blob);
                    var filename = 'Recruitment.csv';

                    $("#RecruitmentCSV").attr({
                        'download': filename,
                        'href': csvUrl
                    });
                }

            }
        }


        function tJSONToCSVConvertor(JSONDataValue, Report_Name) {

            var JSONData = JSON.stringify(JSONDataValue)

            //If JSONData is not an object then JSON.parse will parse the JSON string in an Object
            var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;
            var CSV = '';
            //This condition will generate the Label/Header

            var row = "";

            if (arrData[0] != undefined) {

                if (arrData[0][0] == undefined) {
                    //This loop will extract the label from 1st index of on array
                    for (var index in arrData[0]) {
                        //Now convert each value to string and comma-seprated
                        row += index + ',';
                    }
                    row = row.slice(0, -1);
                    //append Label row with line break
                    CSV += row + '\r\n';


                    //1st loop is to extract each row
                    for (var i = 0; i < arrData.length; i++) {
                        var row = "";
                        //2nd loop will extract each column and convert it in string comma-seprated
                        for (var index in arrData[i]) {
                            row += '"' + arrData[i][index] + '",';
                        }
                        row.slice(0, row.length - 1);
                        //add a line break after each row
                        CSV += row + '\r\n';
                    }

                    if (CSV == '') {
                        alert("Invalid data");
                        return;
                    }

                    var csv = CSV;
                    blob = new Blob([csv], {
                        type: 'text/csv'
                    });
                    var csvUrl = window.URL.createObjectURL(blob);
                    var filename = 'DurationReport.csv';

                    $("#DurationReportCSV").attr({
                        'download': filename,
                        'href': csvUrl
                    });
                }

            }
        }

        $("#AttritionPDF").click(function() {

            var html = d3.select('#Attritionchart').select("svg")
                .attr("version", 1.1)
                .attr("xmlns", "http://www.w3.org/2000/svg")
                .node().parentNode.innerHTML;

            var imgsrc = 'data:image/svg+xml;base64,' + btoa(html);

            var image = new Image();
            image.src = imgsrc;
            image.width = 960;
            image.height = 500;
            image.onload = function() {
                var canvas = document.createElement('canvas');
                canvas.width = image.width;
                canvas.height = image.height;
                canvas.style = "border:1px solid #c3c3c3;background-color:#fff";

                var context = canvas.getContext('2d');
                context.drawImage(image, 0, 40);
                var dataURL = canvas.toDataURL();
                var pdf = new jsPDF('l', 'mm', [297, 210]);
                pdf.addImage(dataURL, 'JPEG', 22, 37);

                pdf.text(95, 20, 'Employee Attrition By Period');
                pdf.save("Employee Attrition By Period.pdf");

            }
        });

        $("#RecruitmentPDF").click(function() {

            var html = d3.select('#Recruitmentchart').select("svg")
                .attr("version", 1.1)
                .attr("xmlns", "http://www.w3.org/2000/svg")
                .node().parentNode.innerHTML;

            var imgsrc = 'data:image/svg+xml;base64,' + btoa(html);

            var image = new Image();
            image.src = imgsrc;
            image.width = 960;
            image.height = 500;
            image.onload = function() {
                var canvas = document.createElement('canvas');
                canvas.width = image.width;
                canvas.height = image.height;
                canvas.style = "border:1px solid #c3c3c3;background-color:#fff";

                var context = canvas.getContext('2d');
                context.drawImage(image, 0, 40);
                var dataURL = canvas.toDataURL();
                var pdf = new jsPDF('l', 'mm', [297, 210]);
                pdf.addImage(dataURL, 'JPEG', 22, 37);

                pdf.text(85, 20, 'Employee Attrition By Designation Group');
                pdf.save("Employee Attrition By Designation Group.pdf");

            }
        });


        $("#DurationReportPDF").click(function() {

            var html = d3.select('#DurationReportchart').select("svg")
                .attr("version", 1.1)
                .attr("xmlns", "http://www.w3.org/2000/svg")
                .node().parentNode.innerHTML;

            var imgsrc = 'data:image/svg+xml;base64,' + btoa(html);

            var image = new Image();
            image.src = imgsrc;
            image.width = 960;
            image.height = 500;
            image.onload = function() {
                var canvas = document.createElement('canvas');
                canvas.width = image.width;
                canvas.height = image.height;
                canvas.style = "border:1px solid #c3c3c3;background-color:#fff";

                var context = canvas.getContext('2d');
                context.drawImage(image, 0, 40);
                var dataURL = canvas.toDataURL();
                var pdf = new jsPDF('l', 'mm', [297, 210]);
                pdf.addImage(dataURL, 'JPEG', 22, 37);

                pdf.text(115, 20, 'Employee Duration');
                pdf.save("Employee Duration.pdf");

            }
        });


        function addThousandsSeparator(input) {
            var output = input
            if (parseFloat(input)) {
                input = new String(input);
                var parts = input.split(".");
                parts[0] = parts[0].split("").reverse().join("").replace(/(\d{3})(?!$)/g, "$1,").split("").reverse().join("");
                output = parts.join(".");
            }
            return output;
        }


        function stackedBar(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var height = config.chartSetting.height
            var width = config.chartSetting.width

            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            var chartSetting_cols = config.chartSetting.columns;

            var x = d3.scale.ordinal()
                .rangeRoundBands([0, width], .1);

            var y = d3.scale.linear()
                .rangeRound([height, 0]);

            var color = d3.scale.ordinal().range(colorArray);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(d3.format(".2s"));

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            function fade(t, a) {
                layer.filter(function(r) {
                    return r[0].type.replace(" ", "_").replace(" ", "_") != a
                }).style("opacity", t)
            }

            var layers = d3.layout.stack()(chartSetting_cols.map(function(c) {
                return data.map(function(d) {
                    return {
                        x: d[variable],
                        y: d[c],
                        type: c
                    };
                });
            }));

            x.domain(layers[0].map(function(d) {
                return d.x;
            }));
            y.domain([0, d3.max(layers[layers.length - 1], function(d) {
                return d.y0 + d.y;
            })]).nice();


            var layer = svg.selectAll(".layer")
                .data(layers)
                .enter().append("g")
                .attr("class", "layer")
                .style("fill", function(d, i) {
                    return color(i);
                })
                .style("stroke", function(d, i) {
                    return d3.rgb(color(i)).darker();
                });

            layer.selectAll("rect")
                .data(function(d) {
                    return d;
                })
                .enter().append("rect")
                .attr("class", "layer_rect")
                .attr("x", function(d) {
                    return x.rangeBand() > 60 ? x(d.x) + ((x.rangeBand() - 59) / 2) : x(d.x);
                })
                .attr("y", function(d) {
                    return y(d.y + d.y0);
                })
                .attr("height", function(d) {
                    return y(d.y0) - y(d.y + d.y0);
                })
                .attr("width", x.rangeBand() > 60 ? 59 : x.rangeBand() - 1);

            xaxis_legends = svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height) + ")")
                .call(xAxis);

            xaxis_legends.selectAll("text")
                .attr("y", 14)
                .attr("x", 0)
                .attr("dy", ".35em")
                .style("text-anchor", "middle")
                .attr("font-size", x.rangeBand() > 12 ? '12px' : x.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(x.rangeBand() / 5) ? d.substring(0, Math.floor(x.rangeBand() / 5)) + '..' : d
                })

            xaxis_legends.append("text")
                .attr("class", "value")
                .attr("transform", "translate(" + (width) + ",0)")
                .attr("x", 16)
                .attr("y", 5)
                .style("text-anchor", "start")
                .text($('#' + Report_Name + 'Groupby').val().replace("_", " "));

            svg.append("g")
                .attr("class", "axis axis--y")
                .call(yAxis).append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("No of Accounts");

            // Draw legend
            var legend = svg.selectAll(".legend")
                .data(chartSetting_cols)
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {
                    return "translate(30," + i * 22 + ")";
                });

            legend.append("rect")
                .attr("x", width - 3)
                .attr("width", 18)
                .attr("height", 18)
                .attr("stroke", function(d, i) {
                    return d3.rgb(color(i)).darker()
                })
                .attr("fill", function(d, i) {
                    return color(i)
                })
                .attr("rx", 2)
                .on("mouseover", function(t) {
                    return fade(.1, t.replace(" ", "_").replace(" ", "_"))
                })
                .on("mouseout", function(t) {
                    return fade(1, t.replace(" ", "_").replace(" ", "_"))
                });

            legend.append("text")
                .attr("x", width + 20)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "start")
                .text(function(d) {
                    return d.length > 13 ? d.substring(0, 11).replace("_", " ") + '..' : d.replace("_", " ")
                });


            $('.layer_rect').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + ' : ' + d.x + ' <br/>' + d.type.replace("_", " ") + ' : ' + addThousandsSeparator(d.y)

                }
            });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('text').css({
                'font': '10px sans-serif'
            });

        }

        function multiLine(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var chartSetting_cols = config.chartSetting.columns;

            var height = config.chartSetting.height
            var width = config.chartSetting.width

            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var xScale = d3.scale.ordinal()
                .rangeRoundBands([0, width], .1);

            var yScale = d3.scale.linear()
                .domain([0, 10])
                .range([height, 0]);

            var color = d3.scale.ordinal()
                .range(colorArray);

            var xAxis = d3.svg.axis().
            scale(xScale)
                .orient("bottom")
                .ticks(7);

            var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left")
                .ticks(5)
                .tickFormat(d3.format(".2s"));

            color.domain(chartSetting_cols);

            var data2 = data;
            var categories = color.domain().map(function(name) {
                return {
                    name: name,
                    values: data.map(function(d) {
                        if (d[name] == 0) {
                            d[name] = 0.1;
                        }
                        return {
                            variable: d[variable],
                            rating: +(d[name]),
                            visible: (true),
                            name: name,
                        };
                    }),
                    visible: (true)
                };
            });

            xScale.domain(data.map(function(d) {
                return d[variable];
            }));

            category_max = d3.max(categories, function(c) {
                return d3.max(c.values, function(v) {
                    return v.rating;
                });
            })

            yScale.domain([0, category_max]);


            xaxis_legends = svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height) + ")")
                .call(xAxis);

            xaxis_legends.selectAll("text")
                .attr("y", 14)
                .attr("x", 0)
                .attr("dy", ".35em")
                .style("text-anchor", "middle")
                .attr("font-size", xScale.rangeBand() > 12 ? '12px' : xScale.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(xScale.rangeBand() / 5) ? d.substring(0, Math.floor(xScale.rangeBand() / 5)) + '..' : d
                })

            xaxis_legends.append("text")
                .attr("class", "value")
                .attr("transform", "translate(" + (width) + ",0)")
                .attr("dy", ".71em")
                .attr("y", -12)
                .style("text-anchor", "end")
                .text($('#' + Report_Name + 'Groupby').val().replace("_", " "));


            svg.append("g")
                .attr("class", "y axis noSelect")
                .call(yAxis).append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("No of Accounts");

            var line = d3.svg.line()
                .x(function(d) {
                    return xScale(d.variable);
                })
                .y(function(d) {
                    return yScale(d.rating);
                })
                .defined(function(d) {
                    return d.rating;
                });

            var issue = svg.selectAll(".issue")
                .data(categories)
                .enter().append("g")
                .attr("class", "issue");

            issue.append("path")
                .attr("class", "line")
                .style("pointer-events", "none")
                .attr("stroke-width", 2)
                .attr("transform", "translate(" + ((xScale.rangeBand() / 2)) + ", 0)")
                .attr("id", function(d) {
                    return "line-" + d.name.replace(" ", "").replace("/", "");
                })
                .attr("d", function(d) {
                    if (d.values.rating == 0) {
                        d.values.rating = 0.1;
                    };
                    return d.visible ? line(d.values) : null;
                }).attr("clip-path", "url(#clip)").style("stroke", function(d) {
                    return color(d.name);
                });

            // what to do when we mouse over a bubble
            var mouseOn = function() {
                var circle = d3.select(this);

                // transition to increase size/opacity of bubble
                circle.transition()
                    .duration(800).style("opacity", 1)
                    .attr("r", 12).ease("elastic");

                // append lines to bubbles that will be used to show the precise data points.
                // translate their location based on margins
                svg.append("g")
                    .attr("class", "guide")
                    .append("line")
                    .attr('stroke-width', '1')
                    .attr("x1", circle.attr("cx"))
                    .attr("x2", circle.attr("cx"))
                    .attr("y1", circle.attr("cy"))
                    .attr("y2", height)
                    .style("stroke", circle.style("fill"))
                    .transition().delay(200).duration(400).styleTween("opacity",
                        function() {
                            return d3.interpolate(0, 1);
                        })

                svg.append("g")
                    .attr("class", "guide")
                    .append("line")
                    .attr('stroke-width', '1')
                    .attr("x1", circle.attr("cx"))
                    .attr("x2", 0)
                    .attr("y1", circle.attr("cy"))
                    .attr("y2", circle.attr("cy"))
                    .style("stroke", circle.style("fill"))
                    .transition().delay(200).duration(400).styleTween("opacity",
                        function() {
                            return d3.interpolate(0, 1);
                        });

                // function to move mouseover item to front of SVG stage, in case
                // another bubble overlaps it
                d3.selection.prototype.moveToFront = function() {
                    return this.each(function() {
                        this.parentNode.appendChild(this);
                    });
                };
            };
            // what happens when we leave a bubble?
            var mouseOff = function() {
                var circle = d3.select(this);

                // go back to original size and opacity
                circle.transition()
                    .duration(800).style("opacity", 1)
                    .attr("r", 6).ease("elastic");

                // fade out guide lines, then remove them
                d3.selectAll(".guide").transition().duration(100).styleTween("opacity",
                        function() {
                            return d3.interpolate(1, 0);
                        })
                    .remove()
            };

            function fade(t, a) {
                issue.filter(function(r) {
                    return r.name.replace(" ", "_").replace(" ", "_") != a
                }).style("opacity", t)
            }

            issue.selectAll("circle")
                .data(function(d) {
                    return d.values
                })
                .enter().append("circle")
                .attr("r", function(d) {
                    return d.visible ? 6 : 0;
                })
                .attr("cx", function(d) {
                    return xScale(d.variable) + (xScale.rangeBand() / 2);
                })
                .attr("cy", function(d) {
                    return yScale(d.rating);
                })
                .style("fill", function(d) {
                    return color(d.name);
                })
                .attr("stroke", function(d, i) {
                    return d3.rgb(color(d.name)).darker()
                })
                .on("mouseover", mouseOn)
                .on("mouseout", mouseOff);

            $('circle').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + ' : ' + d.variable + ' <br/>' + d.name.replace("_", " ") + ' : ' + addThousandsSeparator(d.rating)
                }
            });

            // Draw legend
            var legend = svg.selectAll(".legend")
                .data(chartSetting_cols)
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {
                    return "translate(30," + i * 22 + ")";
                });

            legend.append("rect")
                .attr("x", width - 3)
                .attr("width", 18)
                .attr("height", 18)
                .attr("stroke", function(d, i) {
                    return d3.rgb(color(d)).darker()
                })
                .attr("fill", function(d, i) {
                    return color(d)
                })
                .attr("rx", 2)
                .on("mouseover", function(t) {
                    return fade(.1, t.replace(" ", "_").replace(" ", "_"))
                })
                .on("mouseout", function(t) {
                    return fade(1, t.replace(" ", "_").replace(" ", "_"))
                });

            legend.append("text")
                .attr("x", width + 20)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "start")
                .text(function(d) {
                    return d.length > 19 ? d.substring(0, 17).replace("_", " ") + '..' : d.replace("_", " ")
                });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('.line').css({
                'fill': 'none'
            });
            $('text').css({
                'font': '10px sans-serif'
            });

        }

        function horizontalGroupBar(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var height = config.chartSetting.height
            var width = config.chartSetting.width


            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            var chartSetting_cols = config.chartSetting.columns;

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var layers = d3.layout.stack()(chartSetting_cols.map(function(period, index) {
                return data.map(function(d) {
                    return {
                        x: d[variable],
                        y: parseFloat(d[period]),
                        value: parseFloat(d[period]),
                        name: period,
                        sub_group: index
                    };

                });
            }));

            var yGroupMax = d3.max(layers, function(layer) {
                return d3.max(layer, function(d) {
                    return d.y;
                });
            });

            var y = d3.scale.ordinal()
                .domain(layers[0].map(function(d) {
                    return d.x;
                }))
                .rangeRoundBands([0, height], .1);

            var y1 = d3.scale.ordinal();

            y1.domain(chartSetting_cols).rangeRoundBands([0, y.rangeBand() > 50 ? 50 : y.rangeBand()]);

            height_band = y.rangeBand() > 60 ? 60 : y.rangeBand()


            var x = d3.scale.linear()
                .domain([0, yGroupMax])
                .range([0, width]);

            var color = d3.scale.ordinal()
                .range(colorArray);

            color.domain(chartSetting_cols);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom")
                .ticks(7)
                .tickFormat(d3.format(".2s"));

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left");

            var layer = svg.selectAll(".layer")
                .data(layers)
                .enter().append("g")
                .attr("class", "layer");

            var rect = layer.selectAll("rect")
                .data(function(d) {
                    return d;
                })
                .enter().append("rect")
                .attr("class", "group_bar")
                .attr("y", function(d) {
                    return y.rangeBand() > 60 ? ((y.rangeBand() - 60) / 2) + (y(d.x) + (d.sub_group * height_band / chartSetting_cols.length)) : y(d.x) + (d.sub_group * height_band / chartSetting_cols.length);
                })
                .attr("height", (height_band / (chartSetting_cols.length)) - 2)
                .attr("x", 0)
                .attr("width", function(d) {
                    return x(d.y);
                })
                .style("fill", function(d) {
                    return color(d.name);
                })
                .style("stroke", function(d) {
                    return d3.rgb(color(d.name)).darker();
                })
                .attr("data-title", function(d) {
                    return d.x + ',' + d.name + ' ' + d.value
                })

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis).append("text")
                .attr("transform", "translate(" + (width) + ",0)")
                .attr("y", -12)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("No of Accounts");

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis).selectAll("text")
                //.attr("y", 14)
                //.attr("x", 0)
                .attr("dy", ".35em")
                // .attr("transform", "rotate(90)")
                .style("text-anchor", "end")
                .style("font-size", y.rangeBand() > 9 ? '9px' : y.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(y.rangeBand() / 2.5) ? d.substring(0, Math.floor(y.rangeBand() / 2.5)) + '..' : d
                });

            function fade(opacity, name) {
                rect
                    .filter(function(d) {
                        return d.name.replace(" ", "_").replace(" ", "_") != name;
                    })
                    .style("opacity", opacity);
            }

            var legend = svg.selectAll(".legend")
                .data(chartSetting_cols)
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {
                    return "translate(30," + i * 22 + ")";
                });

            legend.append("rect")
                .attr("x", width - 3)
                .attr("width", 18)
                .attr("height", 18)
                .attr("stroke", function(d, i) {
                    return d3.rgb(color(d)).darker()
                })
                .attr("fill", function(d, i) {
                    return color(d)
                })
                .attr("rx", 2)
                .on("mouseover", function(t) {
                    return fade(.1, t.replace(" ", "_").replace(" ", "_"))
                })
                .on("mouseout", function(t) {
                    return fade(1, t.replace(" ", "_").replace(" ", "_"))
                });

            legend.append("text")
                .attr("x", width + 20)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "start")
                .text(function(d) {
                    return d.length > 19 ? d.substring(0, 17).replace("_", " ") + '..' : d.replace("_", " ")
                });

            $('.group_bar').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + ' : ' + d.x + ' <br/>' + d.name.replace("_", " ") + ' : ' + addThousandsSeparator(d.value)
                }
            });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('text').css({
                'font': '10px sans-serif'
            });

        }

        function groupBar(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var height = config.chartSetting.height
            var width = config.chartSetting.width

            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            var chartSetting_cols = config.chartSetting.columns;

            var x0 = d3.scale.ordinal()
                .rangeRoundBands([0, width], .1);

            var x1 = d3.scale.ordinal();

            var y = d3.scale.linear()
                .rangeRound([height, 0]);

            var color = d3.scale.ordinal()
                .range(colorArray);

            var xAxis = d3.svg.axis()
                .scale(x0)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(d3.format(".2s"));

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            color.domain(chartSetting_cols);

            data.forEach(function(d) {
                var y0 = 0;
                d.groups = color.domain().map(function(name) {
                    return {
                        name: name,
                        value: +d[name],
                        groupby: d[variable]
                    };
                });
            });

            x0.domain(data.map(function(d) {
                return d[variable];
            }));

            x1.domain(chartSetting_cols).rangeRoundBands([0, x0.rangeBand() > 75 ? 75 : x0.rangeBand()]);
            y.domain([0, d3.max(data, function(d) {
                return d3.max(d.groups, function(d) {
                    return d.value;
                });
            })]);

            xaxis_legends = svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height) + ")")
                .call(xAxis);

            xaxis_legends.selectAll("text")
                .attr("y", 14)
                .attr("x", 0)
                .attr("dy", ".35em")
                .style("text-anchor", "middle")
                .attr("font-size", x0.rangeBand() > 12 ? '12px' : x0.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(x0.rangeBand() / 5) ? d.substring(0, Math.floor(x0.rangeBand() / 5)) + '..' : d
                })

            xaxis_legends.append("text")
                .attr("class", "value")
                .attr("transform", "translate(" + (width) + ",0)")
                .attr("x", 8)
                .attr("y", 5)
                .style("text-anchor", "start")
                .text($('#' + Report_Name + 'Groupby').val().replace("_", " "));

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis).append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("No of Accounts");

            var state = svg.selectAll(".state")
                .data(data)
                .enter().append("g")
                .attr("class", "g")
                .attr("transform", function(d) {
                    return "translate(" + x0(d[variable]) + ",0)";
                });

            function fade(t, a) {
                $('.group_bar').css("opacity", t);
                $('.' + a).css("opacity", 1);
            }

            state.selectAll("rect")
                .data(function(d) {
                    return d.groups;
                })
                .enter().append("rect")
                .attr("class", "group_bar")
                .attr("class", function(d) {
                    return "group_bar " + d.name.replace(" ", "_").replace(" ", "_")
                })
                .attr("width", x1.rangeBand())
                .attr("x", function(d) {
                    return x0.rangeBand() > 75 ? ((x0.rangeBand() - 75) / 2) + x1(d.name) : x1(d.name)
                })

                .attr("y", function(d) {
                    return y(d.value);
                })
                .attr("data-title", function(d) {
                    return d.groupby + ',' + d.name + ' ' + d.value
                })
                .attr("height", function(d) {
                    return height - y(d.value);
                })
                .attr("fill", function(d) {
                    return color(d.name);
                })
                .attr("stroke", function(d) {
                    return d3.rgb(color(d.name)).darker();
                });

            var legend = svg.selectAll(".legend")
                .data(chartSetting_cols)
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {
                    return "translate(30," + i * 22 + ")";
                });

            legend.append("rect")
                .attr("x", width - 3)
                .attr("width", 18)
                .attr("height", 18)
                .attr("stroke", function(d, i) {
                    return d3.rgb(color(d)).darker()
                })
                .attr("fill", function(d, i) {
                    return color(d)
                })
                .attr("rx", 2)
                .on("mouseover", function(t) {
                    return fade(.1, t.replace(" ", "_").replace(" ", "_"))
                })
                .on("mouseout", function(t) {
                    return fade(1, t.replace(" ", "_").replace(" ", "_"))
                });

            legend.append("text")
                .attr("x", width + 20)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "start")
                .text(function(d) {
                    return d.length > 19 ? d.substring(0, 17).replace("_", " ") + '..' : d.replace("_", " ")
                });

            $('.group_bar').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + ' : ' + d.groupby + ' <br/>' + d.name.replace("_", " ") + ' : ' + addThousandsSeparator(d.value)
                }
            });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('text').css({
                'font': '10px sans-serif'
            });

        }

        function groupBarPlusLine(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var height = config.chartSetting.height
            var width = config.chartSetting.width

            var line_data = config.chartSetting.line;

            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            var chartSetting_cols = config.chartSetting.columns;

            var x0 = d3.scale.ordinal()
                .rangeRoundBands([0, width], .1);

            var x1 = d3.scale.ordinal();

            var y = d3.scale.linear()
                .rangeRound([height, 0]);

            var y1 = d3.scale.linear()
                .range([height, 0]);

            var color = d3.scale.ordinal()
                .range(colorArray);

            var xAxis = d3.svg.axis()
                .scale(x0)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(d3.format(".2s"));

            var y1Axis = d3.svg.axis()
                .scale(y1)
                .orient("right")
                .ticks(5);

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            color.domain(chartSetting_cols);

            data.forEach(function(d) {
                var y0 = 0;
                d.groups = color.domain().map(function(name) {
                    return {
                        name: name,
                        value: +d[name],
                        groupby: d[variable]
                    };
                });
            });

            x0.domain(data.map(function(d) {
                return d[variable];
            }));
            x1.domain(chartSetting_cols).rangeRoundBands([0, x0.rangeBand() > 75 ? 75 : x0.rangeBand()]);
            y.domain([0, d3.max(data, function(d) {
                return d3.max(d.groups, function(d) {
                    return d.value;
                });
            })]);
            y1.domain([0, d3.max(data, function(d) {
                return d[line_data];
            })]).nice();

            // Define the line
            var valueline = d3.svg.line()
                .x(function(d) {
                    return x0(d[variable]);
                })
                .y(function(d) {
                    return y1(d[line_data]);
                })
                .defined(function(d) {
                    return d[line_data];
                });

            xaxis_legends = svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height) + ")")
                .call(xAxis);

            xaxis_legends.selectAll("text")
                .attr("y", 14)
                .attr("x", 0)
                .attr("dy", ".35em")
                .style("text-anchor", "middle")
                .attr("font-size", x0.rangeBand() > 12 ? '12px' : x0.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(x0.rangeBand() / 5) ? d.substring(0, Math.floor(x0.rangeBand() / 5)) + '..' : d
                })

            xaxis_legends.append("text")
                .attr("class", "value")
                .attr("transform", "translate(" + (width) + ",0)")
                .attr("x", 16)
                .attr("y", 5)
                .style("text-anchor", "start")
                .text($('#' + Report_Name + 'Groupby').val().replace("_", " "));

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis).append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("No of Accounts");


            // Add the Y Axis
            svg.append("g")
                .attr("class", "axis axis--y1")
                .attr("transform", "translate(" + width + ",0)")
                .call(y1Axis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -15)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text(line_data);

            var state = svg.selectAll(".state")
                .data(data)
                .enter().append("g")
                .attr("class", "g")
                .attr("transform", function(d) {
                    return "translate(" + x0(d[variable]) + ",0)";
                });

            function fade(t, a) {
                $('.group_bar').css("opacity", t);
                $('.' + a).css("opacity", 1);
            }

            state.selectAll("rect")
                .data(function(d) {
                    return d.groups;
                })
                .enter().append("rect")
                .attr("class", "group_bar")
                .attr("class", function(d) {
                    return "group_bar " + d.name.replace(" ", "_").replace(" ", "_")
                })
                .attr("width", x1.rangeBand())
                .attr("x", function(d) {
                    return x0.rangeBand() > 75 ? ((x0.rangeBand() - 75) / 2) + x1(d.name) : x1(d.name)
                })
                .attr("y", function(d) {
                    return y(d.value);
                })
                .attr("data-title", function(d) {
                    return d.groupby + ',' + d.name + ' ' + d.value
                })
                .attr("height", function(d) {
                    return height - y(d.value);
                })
                .attr("fill", function(d) {
                    return color(d.name);
                })
                .attr("stroke", function(d) {
                    return d3.rgb(color(d.name)).darker();
                });

            // Add the valueline path.
            svg.append("path")
                .attr("class", "line")
                .attr("transform", "translate(" + x0.rangeBand() / 2 + ",0)")
                .attr("d", valueline(data))
                .attr("stroke", "steelblue")
                .attr("stroke-width", 2)
                .attr("fill", 'none');

            // what to do when we mouse over a bubble
            var mouseOn = function() {
                var circle = d3.select(this);

                // transition to increase size/opacity of bubble
                circle.transition()
                    .duration(800).style("opacity", 1)
                    .attr("r", 12).ease("elastic");

                // append lines to bubbles that will be used to show the precise data points.
                // translate their location based on margins
                svg.append("g")
                    .attr("class", "guide")
                    .append("line")
                    .attr('stroke-width', '1')
                    .attr("x1", parseFloat(circle.attr("cx")) + (x0.rangeBand() / 2))
                    .attr("x2", parseFloat(circle.attr("cx")) + (x0.rangeBand() / 2))
                    .attr("y1", circle.attr("cy"))
                    .attr("y2", height)
                    .style("stroke", circle.style("fill"))
                    .transition().delay(200).duration(400).styleTween("opacity",
                        function() {
                            return d3.interpolate(0, 1);
                        })

                svg.append("g")
                    .attr("class", "guide")
                    .append("line")
                    .attr('stroke-width', '1')
                    .attr("x1", parseFloat(circle.attr("cx")) + (x0.rangeBand() / 2))
                    .attr("x2", width)
                    .attr("y1", circle.attr("cy"))
                    .attr("y2", circle.attr("cy"))
                    .style("stroke", circle.style("fill"))
                    .transition().delay(200).duration(400).styleTween("opacity",
                        function() {
                            return d3.interpolate(0, 1);
                        });

                // function to move mouseover item to front of SVG stage, in case
                // another bubble overlaps it
                d3.selection.prototype.moveToFront = function() {
                    return this.each(function() {
                        this.parentNode.appendChild(this);
                    });
                };
            };
            // what happens when we leave a bubble?
            var mouseOff = function() {
                var circle = d3.select(this);

                // go back to original size and opacity
                circle.transition()
                    .duration(800).style("opacity", 1)
                    .attr("r", 6).ease("elastic");

                // fade out guide lines, then remove them
                d3.selectAll(".guide").transition().duration(100).styleTween("opacity",
                        function() {
                            return d3.interpolate(1, 0);
                        })
                    .remove()
            };

            var circles = svg.selectAll(".circle")
                .data(data)
                .enter()
                .append("g")
                .append("circle")
                .attr("class", 'circle')
                .attr("r", 6)
                .attr("transform", "translate(" + x0.rangeBand() / 2 + ",0)")
                .attr("cx", function(d) {
                    return x0(d[variable]);
                })
                .attr("cy", function(d) {
                    return y1(d[line_data]);
                })
                .attr("fill", d3.rgb('steelblue').brighter())
                .attr("stroke", 'steelblue')
                .on("mouseover", mouseOn)
                .on("mouseout", mouseOff);


            var linelegend = svg.selectAll(".linelegend")
                .data([line_data])
                .enter().append("g")
                .attr("class", "linelegend")
                .attr("transform", function(d, i) {
                    return "translate(30," + i * 22 + ")";
                });

            linelegend.append("rect")
                .attr("x", width - 1)
                .attr("y", 2)
                .attr("width", 14)
                .attr("height", 14)
                .attr("rx", 7)
                .attr("stroke", function(d, i) {
                    return 'steelblue'
                })
                .attr("fill", function(d, i) {
                    return d3.rgb('steelblue').brighter()
                });

            linelegend.append("text")
                .attr("x", width + 20)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "start")
                .text(function(d) {
                    return d.length > 19 ? d.substring(0, 17).replace("_", " ") + '..' : d.replace("_", " ")
                });


            var legend = svg.selectAll(".legend")
                .data(chartSetting_cols)
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {
                    return "translate(30," + ((i + 1) * 22) + ")";
                });

            legend.append("rect")
                .attr("x", width - 3)
                .attr("width", 18)
                .attr("height", 18)
                .attr("stroke", function(d, i) {
                    return d3.rgb(color(d)).darker()
                })
                .attr("fill", function(d, i) {
                    return color(d)
                })
                .attr("rx", 2)
                .on("mouseover", function(t) {
                    return fade(.1, t.replace(" ", "_").replace(" ", "_"))
                })
                .on("mouseout", function(t) {
                    return fade(1, t.replace(" ", "_").replace(" ", "_"))
                });

            legend.append("text")
                .attr("x", width + 20)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "start")
                .text(function(d) {
                    return d.length > 19 ? d.substring(0, 17).replace("_", " ") + '..' : d.replace("_", " ")
                });

            $('.group_bar').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + ' : ' + d.groupby + ' <br/>' + d.name.replace("_", " ") + ' : ' + addThousandsSeparator(d.value)
                }
            });

            $('circle').tipsy({
                gravity: 'e',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + " : " + d[variable] + '<br/> ' + line_data + ' : ' + d[line_data].toFixed(2);
                }
            });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('text').css({
                'font': '10px sans-serif'
            });

        }

        function areaChart(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var height = config.chartSetting.height
            var width = config.chartSetting.width

            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            var chartSetting_cols = config.chartSetting.columns;

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var colors = d3.scale.category20();

            x = d3.scale.ordinal().rangeRoundBands([0, width], .1),
                y = d3.scale.linear().range([height, 0]),

                xAxis = d3.svg.axis().scale(x).orient("bottom"),
                yAxis = d3.svg.axis().scale(y).orient("left").ticks(4),

                color = d3.scale.ordinal().range(colorArray);

            color.domain(['Completed']);
            data.forEach(function(d) {
                d.Day = d.Day;
            });

            var area = d3.svg.area()
                .x(function(d) {
                    return x(d[variable]);
                })
                .y1(function(d) {
                    return y(d.Completed);
                });
            var color = d3.scale.ordinal().range(colorArray);

            var parameterdata = _.uniq(_.pluck(data, variable));

            x.domain(parameterdata).rangeRoundBands([0, width]);

            y.domain([0, d3.max(data, function(d) {
                return d.Completed;
            })]);

            area.y0(y(0));

            svg.append("path")
                .datum(data)
                .attr("fill", "lightblue")
                .attr("stroke", "steelblue")
                .attr("transform", "translate(" + x.rangeBand() / 2 + ",0)")
                .attr("d", area);

            var issue = svg.selectAll(".issue")
                .data(data)
                .enter().append("g")
                .attr("class", "issue");

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis).selectAll("text")
                .attr("y", 14)
                .attr("x", 0)
                .attr("dy", ".35em")
                .style("text-anchor", "middle")
                .attr("font-size", x.rangeBand() > 12 ? '12px' : x.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(x.rangeBand() / 5) ? d.substring(0, Math.floor(x.rangeBand() / 5)) + '..' : d
                });


            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("fill", "#000")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "0.71em")
                .attr("text-anchor", "end")
                .text("# of Accounts");

            issue.selectAll("circle")
                .data(data)
                .enter().append("svg:circle")
                .attr("stroke", function(d) {
                    return d3.rgb(color(d.name)).darker();
                })
                .attr("fill", function(d) {
                    return color(d.name);
                })
                .attr("transform", "translate(" + x.rangeBand() / 2 + ",0)")
                .attr("cx", function(d, i) {
                    return x(d[variable]);
                })
                .attr("cy", function(d) {
                    return y(d.Completed);
                })
                .attr("r", function(d) {
                    return 5;
                });

            $('circle').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + ' : ' + (d[variable]) + "<br/> Production : " + (d.Completed);

                }
            });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('text').css({
                'font': '10px sans-serif'
            });
        }

        function lineChart(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var height = config.chartSetting.height
            var width = config.chartSetting.width

            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            var chartSetting_cols = config.chartSetting.columns;

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var colors = d3.scale.category20();

            x = d3.scale.ordinal().rangeRoundBands([0, width], .1),
                y = d3.scale.linear().range([height, 0]),

                xAxis = d3.svg.axis().scale(x).orient("bottom"),
                yAxis = d3.svg.axis().scale(y).orient("left").ticks(4),

                color = d3.scale.ordinal().range(colorArray);

            color.domain(d3.keys(data[0]).filter(function(key) {
                return key !== "Day";
            }));
            data.forEach(function(d) {
                d.Day = d.Day;
            });

            x.domain(data.map(function(d) {
                return d[variable];
            }));

            y.domain([0, d3.max(data, function(d) {
                return d.Completed;
            })]);

            svg.append("g")
                .attr("class", "x axis noSelect")
                .attr("transform", "translate(0," + height + ")")
                .attr("fill", "#000")
                .call(xAxis).selectAll("text")
                .attr("y", 14)
                .attr("x", 0)
                .attr("dy", ".35em")
                .style("text-anchor", "middle")
                .attr("font-size", x.rangeBand() > 12 ? '12px' : x.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(x.rangeBand() / 5) ? d.substring(0, Math.floor(x.rangeBand() / 5)) + '..' : d
                });



            svg.append("g")
                .attr("class", "y axis noSelect")
                .call(yAxis).append("text")
                .attr("fill", "#000")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "0.71em")
                .attr("text-anchor", "end")
                .text("# of Accounts");

            var line = d3.svg.line().x(function(d) {
                return x(d[variable]);
            }).y(function(d) {
                return y(d.Completed);
            });

            var issue = svg.selectAll(".issue").data(data).enter().append("g").attr("class", "issue");

            issue.append("path")
                .datum(data)
                .attr("class", "line")
                .attr("transform", "translate(" + x.rangeBand() / 2 + ",0)")
                .attr("d", line)
                .attr("stroke", "steelblue")
                .attr("stroke-width", "1.5px")
                .attr("fill", 'none');

            issue.selectAll("circle")
                .data(data)
                .enter().append("svg:circle")
                .attr("transform", "translate(" + x.rangeBand() / 2 + ",0)")
                .attr("stroke", function(d) {
                    return d3.rgb(color(d.name)).darker();
                })
                .attr("fill", function(d) {
                    return color(d.name);
                })
                .attr("cx", function(d, i) {
                    return x(d[variable]);
                })
                .attr("cy", function(d) {
                    return y(d.Completed);
                })
                .attr("r", function(d) {
                    return 5;
                });

            $('circle').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;

                    return variable.replace("_", " ") + ' : ' + (d[variable]) + "<br/> Production : " + (d.Completed);

                }
            });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('text').css({
                'font': '10px sans-serif'
            });

        }

        function barChart(config, data, variable, Report_Name) {

            var elementId = config.chartSetting.elementId;
            var variables = config.chartSetting.variable;

            var height = config.chartSetting.height
            var width = config.chartSetting.width

            var line_data = config.chartSetting.line;

            var color = d3.scale.ordinal()
                .range(colorArray);

            var margin = config.chartSetting.margin,
                width = width - margin.left - margin.right,
                height = height - margin.top - margin.bottom,
                colorArray = config.chartSetting.colorArray;

            var chartSetting_cols = config.chartSetting.columns;

            var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

            var y = d3.scale.linear().range([height, 0]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .ticks(5);

            data.forEach(function(d) {

                d.groups = color.domain().map(function(name) {
                    return {
                        name: name,
                        value: +d[name],
                        groupby: d[variable]
                    };
                });

                d.Completed = +d.Completed;
            });

            x.domain(data.map(function(d) {
                return d[variable];
            }));
            y.domain([0, d3.max(data, function(d) {
                return d.Completed;
            })]);

            d3.select('#' + elementId).select('svg').remove();

            var svg = d3.select("#" + elementId).append("svg")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + ' ' + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            color.domain(chartSetting_cols)

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .selectAll("text")
                .attr("y", 14)
                .attr("x", 0)
                .attr("dy", ".35em")
                .style("text-anchor", "middle")
                .attr("font-size", x.rangeBand() > 12 ? '12px' : x.rangeBand() + 'px')
                .text(function(d) {
                    return d.length > Math.floor(x.rangeBand() / 5) ? d.substring(0, Math.floor(x.rangeBand() / 5)) + '..' : d
                });

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("# of Accounts");

            svg.selectAll("bar")
                .data(data)
                .enter().append("rect")
                .style("fill", "steelblue")
                .attr("x", function(d) {
                    return x.rangeBand() > 60 ? x(d[variable]) + ((x.rangeBand() - 59) / 2) : x(d[variable]);
                })
                .attr("width", x.rangeBand() > 60 ? 59 : x.rangeBand() - 1)
                .attr("y", function(d) {
                    return y(d.Completed);
                })
                .attr("height", function(d) {
                    return height - y(d.Completed);
                });

            //Adding Label to top of the each bar
            svg.selectAll("barText")
                .data(data)
                .enter().append("text")
                .attr("x", function(d) {
                    return x(d[variable]) + x.rangeBand() / 2;
                })
                .attr("text-anchor", 'middle')
                .attr("font-size", x.rangeBand() > 12 ? '12px' : x0.rangeBand() + 'px')
                .attr("y", function(d) {
                    return y(d.Completed) - 4;
                })
                .text(function(d) {
                    return d.Completed
                });

            //Tool Tip for ripsy
            $('rect').tipsy({
                gravity: 'w',
                html: true,
                title: function() {
                    var d = this.__data__;
                    return variable.replace("_", " ") + ' : ' + (d[variable]) + "<br/> Production : " + (d.Completed);
                }
            });

            $('.axis path,.axis line,.axis1 path,.axis1 line').css({
                'fill': 'none',
                'stroke': '#000',
                'shape-rendering': 'crispEdges'
            });
            $('text').css({
                'font': '10px sans-serif'
            });

        }

        function tabExpansion(Report_Name) {

            var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            var quarterNames = ["Q1", "Q2", "Q3", "Q4"];

            if ($('#' + Report_Name + 'Groupby').has("option")[0] == undefined) {

                var select_box = d3.select('#' + Report_Name + 'Groupby')
                    .selectAll("option")
                    .data(['Day', 'Week', 'Month', 'Quarter', 'Year'])
                    .enter().append("option")
                    .attr("value", function(d) {
                        return d;
                    })
                    .attr("class", "name")
                    //.attr("selected", "")
                    .text(function(d) {
                        return d.replace("_", " ")
                    });


                var select_box = d3.select('#' + Report_Name + 'MaritalStatus')
                    .selectAll("option")
                    .data(['Single','Married','Divorced'])
                    .enter().append("option")
                    .attr("value", function(d) {
                        return d;
                    })
                    .attr("class", "name")
                    .attr("selected", "")
                    .text(function(d) {
                        return d
                    });

                var select_box = d3.select('#' + Report_Name + 'DesigGrp')
                    .selectAll("option")
                    .data(['TM & MT','SBM','ABM','RBM','ZBM','UnKnown','HBM'])
                    .enter().append("option")
                    .attr("value", function(d, i) {
                        return d;
                    })
                    .attr("class", "name")
                    .attr("selected", "")
                    .text(function(d) {
                        return d
                    });

                var lm = new Date();
                lm.setMonth(-1);

                $('#' + Report_Name + 'datepicker').daterangepicker({
                    startDate: lm,
                    endDate: new Date(),
                    ranges: {
                        'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                        'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                        'This Month': [moment().startOf('month'), moment()],
                        'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],
                        'This Year': [moment().startOf('year'), moment()],
                        'Last Year': [moment().subtract(1, 'year').startOf('year'), , moment().subtract(1, 'year').endOf('year')],

                    }
                });

                $('.' + Report_Name + 'multiple').multipleSelect({
                    placeholder: "Here is the placeholder"
                });


            }


            $('.AttritionGroupby_options').click();

            $('.' + Report_Name + 'Groupby_options').on('click', function() {

                d3.csv('data/data.csv', function(data) {

                    parseDate = d3.time.format("%m/%d/%Y").parse;
                    parseTatDate = d3.time.format("%Y-%m-%d").parse;

                    Date.prototype.getWeek = function() {
                        var onejan = new Date(this.getFullYear(), 0, 1);
                        return Math.ceil((((this - onejan) / 86400000) + onejan.getDay() + 1) / 7);
                    }

                    Date.prototype.getQuarter = function() {
                        return Math.floor((this.getMonth()) / 3);
                    }

                    function getDateOfWeek(weekNumber, year) {
                        //Create a date object starting january first of chosen year, plus the number of days in a week multiplied by the week number to get the right date.
                        return new Date(year, 0, 1 + ((weekNumber - 1) * 7));
                    }

                    data.forEach(function(d) {

                        d['SortedDate'] = parseDate(d['DOL'])
                        d['SortedDateJoin'] = parseDate(d['DOJ'])

                        d['DOL'] = (parseDate(d['DOL']).getMonth() + 1) + '/' + (parseDate(d['DOL']).getDate()) + '/' + (parseDate(d['DOL']).getYear() + 1900)

                        d['WeekDate'] = getDateOfWeek(d['SortedDate'].getWeek(), 2017)
                        d['WeekDate'] = (d['WeekDate'].getMonth() + 1) + '/' + (d['WeekDate'].getDate()) + '/' + (d['WeekDate'].getYear() + 1900)

                        d['MonthDate'] = monthNames[d['SortedDate'].getMonth()].substring(0, 3) + ' - ' + (d['SortedDate'].getYear() + 1900);
                        d['YearDate'] = d['SortedDate'].getYear() + 1900;
                        d['QuarterDate'] = quarterNames[d['SortedDate'].getQuarter()].substring(0, 3) + ' - ' + (d['SortedDate'].getYear() + 1900);
                        d['DayDate'] = d['DOL']

                        d['Male (%)'] = (d['Gender'] != 'Male' ? 0 : 1);
                        d['Total_Employee'] = 1
                        d['Male'] = (d['Gender'] != 'Male' ? 0 : 1)
                        d['Female'] = (d['Gender'] != 'Male' ? 1 : 0)

                        d['DOJ'] = parseDate(d['DOJ'])
                        
                        d['STAY'] = (d['SortedDate'] - d['SortedDateJoin']) / (1000 * 3600 * 24)
                        d['Short_Stay'] = (d['STAY'] < 365 ? 1 : 0)
                        d['Long_Stay'] = (d['STAY'] < 365 ? 0 : 1)
                        d['Long Stay (%)'] = (d['STAY'] < 365 ? 0 : 1)

                    });

                    data = data.sort(function(x, y) {
                        return d3.ascending(x.SortedDate, y.SortedDate);
                    });

                    var odata = data
                    var fdata = data
                    var tdata = data

                    var AttritionMaritalStatus = [];
                    $('#AttritionMaritalStatus :selected').each(function(i, selected) {
                        AttritionMaritalStatus[i] = $(selected).val();
                    });

                    var AttritionDesigGrp = [];
                    $('#AttritionDesigGrp :selected').each(function(i, selected) {
                        AttritionDesigGrp[i] = $(selected).val();
                    });

                    var RecruitmentMaritalStatus = [];
                    $('#RecruitmentMaritalStatus :selected').each(function(i, selected) {
                        RecruitmentMaritalStatus[i] = $(selected).val();
                    });

                    var RecruitmentDesigGrp = [];
                    $('#RecruitmentDesigGrp :selected').each(function(i, selected) {
                        RecruitmentDesigGrp[i] = $(selected).val();
                    });

                    var DurationReportMaritalStatus = [];
                    $('#DurationReportMaritalStatus :selected').each(function(i, selected) {
                        DurationReportMaritalStatus[i] = $(selected).val();
                    });

                    var DurationReportDesigGrp = [];
                    $('#DurationReportDesigGrp :selected').each(function(i, selected) {
                        DurationReportDesigGrp[i] = $(selected).val();
                    });

                    //<!-- fdata = fdata.filter(function(x, y) {
                     //   return x.FinalStatus == 'Completed'
                    //}) -->

                    var Attritiongroupval = $('#AttritionGroupby').val();
                    var RecruitmentGroupby = $('#RecruitmentGroupby').val();
                    var DurationReportGroupby = $('#DurationReportGroupby').val();

                    var Attritiondatepicker = $('#Attritiondatepicker').val().split(' - ');
                    var Recruitmentdatepicker = $('#Recruitmentdatepicker').val().split(' - ');
                    var DurationReportdatepicker = $('#DurationReportdatepicker').val().split(' - ');

                    odata = odata.filter(function(x, y) {
                        return x.SortedDate >= new Date(Attritiondatepicker[0])
                    })
                    fdata = fdata.filter(function(x, y) {
                        return x.SortedDate >= new Date(Recruitmentdatepicker[0])
                    })
                    tdata = tdata.filter(function(x, y) {
                        return x.SortedDate >= new Date(DurationReportdatepicker[0])
                    })

                    odata = odata.filter(function(x, y) {
                        return x.SortedDate <= new Date(Attritiondatepicker[1])
                    })
                    fdata = fdata.filter(function(x, y) {
                        return x.SortedDate <= new Date(Recruitmentdatepicker[1])
                    })
                    tdata = tdata.filter(function(x, y) {
                        return x.SortedDate <= new Date(DurationReportdatepicker[1])
                    })

                    var odata_DesigGrp = []
                    _.each(odata, function(d) {
                        if (_.contains(AttritionDesigGrp, d.DesigGrp)) {
                            odata_DesigGrp.push(d);
                        }
                    });

                    var odata_MaritalStatus = []
                    _.each(odata_DesigGrp, function(d) {
                        if (_.contains(AttritionMaritalStatus, d.MaritalStatus)) {
                            odata_MaritalStatus.push(d);
                        }
                    });


                    var fdata_DesigGrp = []
                    _.each(fdata, function(d) {
                        if (_.contains(RecruitmentDesigGrp, d.DesigGrp)) {
                            fdata_DesigGrp.push(d);
                        }
                    });

                    var fdata_MaritalStatus = []
                    _.each(fdata_DesigGrp, function(d) {
                        if (_.contains(RecruitmentMaritalStatus, d.MaritalStatus)) {
                            fdata_MaritalStatus.push(d);
                        }
                    });


                    var tdata_DesigGrp = []
                    _.each(tdata, function(d) {
                        if (_.contains(DurationReportDesigGrp, d.DesigGrp)) {
                            tdata_DesigGrp.push(d);
                        }
                    });

                    var tdata_MaritalStatus = []
                    _.each(tdata_DesigGrp, function(d) {
                        if (_.contains(DurationReportMaritalStatus, d.MaritalStatus)) {
                            tdata_MaritalStatus.push(d);
                        }
                    });


                    var DesigGrpdata_sets = d3.nest()
                        .key(function(d) {
                            return d[RecruitmentGroupby + 'Date']
                        })
                        .key(function(d) {
                            return d['DesigGrp']
                        })
                        .rollup(function(d) {
                            return {
                                'Total_Employee': d3.sum(d, function(g) {
                                    return g.Total_Employee;
                                })
                            };
                        }).entries(fdata_MaritalStatus);

                    var parameterby = _.uniq(_.pluck(fdata_DesigGrp, 'DesigGrp'));

                    DesigGrpgroup_data = []
                    DesigGrpdata_sets.forEach(function(g) {
                        g.values[$('#RecruitmentGroupby').val()] = g.key

                        g.values.forEach(function(c) {
                            g.values[c.key] = c.values.Total_Employee
                        });

                        DesigGrpgroup_data.push(g.values)
                    });

                    var data_sets = d3.nest()
                        .key(function(d) {
                            return d[Attritiongroupval + 'Date']
                        })
                        .rollup(function(d) {
                            return {
                                'Total_Employee': d3.sum(d, function(g) {
                                    return g.Total_Employee;
                                }),
                                'Male': d3.sum(d, function(g) {
                                    return g.Male;
                                }),
                                'Female': d3.sum(d, function(g) {
                                    return g.Female;
                                }),
                                'Male (%)': (d3.sum(d, function(g) {
                                    return g['Male (%)'];
                                }) * 100 / d3.sum(d, function(g) {
                                    return g.Total_Employee;
                                }))
                            };
                        }).entries(odata_MaritalStatus);

                    group_data = []
                    data_sets.forEach(function(g) {
                        g.values[$('#AttritionGroupby').val()] = g.key
                        group_data.push(g.values)
                      
                    });

                    var TATdata_sets = d3.nest()
                        .key(function(d) {
                            return d[DurationReportGroupby + 'Date']
                        })
                        .rollup(function(d) {
                            return {
                                'Total_Employee': d3.sum(d, function(g) {
                                    return g.Total_Employee;
                                }),
                                'Short_Stay': d3.sum(d, function(g) {
                                    return g['Short_Stay'];
                                }),
                                'Long_Stay': d3.sum(d, function(g) {
                                    return g['Long_Stay'];
                                }),
                                'Long Stay (%)': (d3.sum(d, function(g) {
                                    return g['Long Stay (%)'];
                                }) * 100 / d3.sum(d, function(g) {
                                    return g.Total_Employee;
                                }))
                            };
                        }).entries(tdata_MaritalStatus);

                    TATgroup_data = []
                    TATdata_sets.forEach(function(g) {
                        g.values[$('#DurationReportGroupby').val()] = g.key
                        TATgroup_data.push(g.values)

                    });

                    var config = {
                        chartSetting: {
                            elementId: "Attritionchart",
                            adaptive: "true",
                            width: 960,
                            height: 420,
                            margin: {
                                top: 15,
                                right: 150,
                                bottom: 20,
                                left: 70
                            },
                            colorArray: ['#00A3D9', '#00D936', '#FF8000'],
                            columns: ['Total_Employee', 'Male', 'Female'],
                            variable: $('#AttritionGroupby').val(),
                            line: 'Male (%)'
                        }
                    }

                    var DesigGrpconfig = {
                        chartSetting: {
                            elementId: "Recruitmentchart",
                            adaptive: "true",
                            width: 960,
                            height: 420,
                            margin: {
                                top: 15,
                                right: 200,
                                bottom: 20,
                                left: 70
                            },
                            colorArray: ['#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f','#ff7f00','#cab2d6'],
                            columns: parameterby,
                            variable: $('#RecruitmentGroupby').val()
                        }
                    }

                    var TATconfig = {
                        chartSetting: {
                            elementId: "DurationReportchart",
                            adaptive: "true",
                            width: 960,
                            height: 420,
                            margin: {
                                top: 15,
                                right: 150,
                                bottom: 20,
                                left: 70
                            },
                            colorArray: ['#00A3D9', '#00D936', '#FF8000'],
                            columns: ['Total_Employee', 'Short_Stay', 'Long_Stay'],
                            variable: $('DurationReportGroupby').val(),
                            line: 'Long Stay (%)'
                        }
                    }

                    if (group_data.length == 0) {
                        d3.select('#Attritionchart').select('svg').remove();
                    } else {
                        if ($('#AttritionChartby').val() == 'multiLine') {
                            multiLine(config, group_data, $('#AttritionGroupby').val(), Report_Name);
                        } else if ($('#AttritionChartby').val() == 'groupBar') {
                            groupBar(config, group_data, $('#AttritionGroupby').val(), Report_Name);
                        } else if ($('#AttritionChartby').val() == 'horizontalGroupBar') {
                            horizontalGroupBar(config, group_data, $('#AttritionGroupby').val(), Report_Name);
                        } else {
                            groupBarPlusLine(config, group_data, $('#AttritionGroupby').val(), Report_Name);
                        }
                    }

                    if (DesigGrpgroup_data.length == 0) {
                        d3.select('#Recruitmentchart').select('svg').remove();
                    } else {
                        if ($('#RecruitmentChartby').val() == 'multiLine') {
                            multiLine(DesigGrpconfig, DesigGrpgroup_data, $('#RecruitmentGroupby').val(), Report_Name);
                        } else if ($('#RecruitmentChartby').val() == 'groupBar') {
                            groupBar(DesigGrpconfig, DesigGrpgroup_data, $('#RecruitmentGroupby').val(), Report_Name);
                        } else if ($('#RecruitmentChartby').val() == 'horizontalGroupBar') {
                            horizontalGroupBar(DesigGrpconfig, DesigGrpgroup_data, $('#RecruitmentGroupby').val(), Report_Name);
                        } else {
                            stackedBar(DesigGrpconfig, DesigGrpgroup_data, $('#RecruitmentGroupby').val(), Report_Name);
                        }
                    }

                    if (TATgroup_data.length == 0) {
                        d3.select('#DurationReportchart').select('svg').remove();
                    } else {
                        if ($('#DurationReportChartby').val() == 'multiLine') {
                            multiLine(TATconfig, TATgroup_data, $('#DurationReportGroupby').val(), Report_Name);
                        } else if ($('#DurationReportChartby').val() == 'groupBar') {
                            groupBar(TATconfig, TATgroup_data, $('#DurationReportGroupby').val(), Report_Name);
                        } else if ($('#DurationReportChartby').val() == 'horizontalGroupBar') {
                            horizontalGroupBar(TATconfig, TATgroup_data, $('#DurationReportGroupby').val(), Report_Name);
                        } else {
                            groupBarPlusLine(TATconfig, TATgroup_data, $('#DurationReportGroupby').val(), Report_Name);
                        }
                    }

                    group_data.forEach(function(o) {
                        o.groups = $('#AttritionGroupby').val()
                    });

                    DesigGrpgroup_datanew = []
                    DesigGrpgroup_data.forEach(function(f) {
                        r = {}
                        parameterby.forEach(function(p) {
                            if (f[p] == undefined) {
                                r[p] = 0
                            } else {
                                r[p] = f[p]
                            }

                        });
                        r[$('#RecruitmentGroupby').val()] = f[$('#RecruitmentGroupby').val()]
                        r['groups'] = $('#RecruitmentGroupby').val()
                        DesigGrpgroup_datanew.push(r);
                    });

                    TATgroup_data.forEach(function(t) {
                        t.groups = $('#DurationReportGroupby').val()
                    });

                    oJSONToCSVConvertor(group_data, Report_Name);
                    fJSONToCSVConvertor(DesigGrpgroup_datanew, Report_Name);
                    tJSONToCSVConvertor(TATgroup_data, Report_Name);

                });

            });

        }

        document.getElementById('Attrition').style.display = "block";

        tabExpansion('Attrition');
        tabExpansion('Recruitment');
        tabExpansion('DurationReport');

        function openCity(evt, cityName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
            tabExpansion(cityName);

        }

    </script>
</body>

</html>
