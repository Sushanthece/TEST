<!DOCTYPE html>
<!-- saved from url=(0053)http://localhost:2311/normalizedRadialStackedBar.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Stacked</title>
<style>
</style>
<script type="text/javascript" src="./normalized_radial_files/jquery-1.11.3.js.download"></script>
<script src="./normalized_radial_files/d3.v4.min.js.download"></script>
<script type="text/javascript" src="./normalized_radial_files/jquery.tipsy.js.download"></script>
<script type="text/javascript" src="./normalized_radial_files/d3-scale-radial.js.download"></script>
<link rel="stylesheet" type="text/css" media="screen" href="./normalized_radial_files/tipsy.css">
</head>
<body>

    <div id="chartContainer">
        <div id="chart1"><svg viewBox="0 0 960 425"><g transform="translate(470,202.5)"><g><g fill="#69d900"><path d="M0.6999970833369782,-163.09701551686248A163.0985176708371,163.0985176708371,0,0,1,127.07794038486841,-102.23660564574804L109.01859830048882,-87.83476091273123A140,140,0,0,0,0.6999970833369729,-139.99825000364584Z"></path><path d="M128.98248286435938,-101.96476784147634A164.4180487866856,164.4180487866856,0,0,1,160.45005629485854,35.903679502213315L136.64396558991425,30.47009464806978A140,140,0,0,0,109.89148038607175,-86.74020139795392Z"></path><path d="M153.7503510521666,35.81051312547209A157.86564952190858,157.86564952190858,0,0,1,69.12534050781561,141.92691992237633L61.37363976120565,125.830347462215A140,140,0,0,0,136.33243758041257,31.834988038051954Z"></path><path d="M66.60097293854908,139.91167402688353A154.95472282368894,154.95472282368894,0,0,1,-66.60097293854905,139.91167402688356L-60.11228860178744,126.43778216599425A140,140,0,0,0,60.112288601787455,126.43778216599425Z"></path><path d="M-69.97901522640755,143.69959374124537A159.83314992033644,159.83314992033644,0,0,1,-155.66854073305194,36.24832740277672L-136.33243758041257,31.834988038051957A140,140,0,0,0,-61.37363976120563,125.83034746221502Z"></path><path d="M-155.16522204553993,34.69745057157278A158.99735597992958,158.99735597992958,0,0,1,-124.74437485235698,-98.58498948269506L-109.89148038607175,-86.74020139795392A140,140,0,0,0,-136.64396558991425,30.47009464806981Z"></path><path d="M-130.56050533475488,-105.013858518337A167.55284549710237,167.55284549710237,0,0,1,-0.6999970833369726,-167.55138327766554L-0.69999708333699,-139.99825000364584A140,140,0,0,0,-109.01859830048883,-87.8347609127312Z"></path></g><g fill="#00a3d9"><path d="M0.6999970833369846,-176.82775267132303A176.8291381834659,176.8291381834659,0,0,1,137.81306296971917,-110.79758023355699L127.07794038486841,-102.23660564574804A163.0985176708371,163.0985176708371,0,0,0,0.6999970833369782,-163.09701551686248Z"></path><path d="M135.4474205199242,-107.1203835825731A172.68694306281174,172.68694306281174,0,0,1,168.51170169065293,37.74369745665078L160.45005629485854,35.903679502213315A164.4180487866856,164.4180487866856,0,0,0,128.98248286435938,-101.96476784147634Z"></path><path d="M169.38819882458145,39.37974983303232A173.90551054508924,173.90551054508924,0,0,1,76.08483749058448,156.37846431647645L69.12534050781561,141.92691992237633A157.86564952190858,157.86564952190858,0,0,0,153.7503510521666,35.81051312547209Z"></path><path d="M74.3845032113417,156.07434117920596A172.89376591572434,172.89376591572434,0,0,1,-74.38450321134167,156.07434117920596L-66.60097293854905,139.91167402688356A154.95472282368894,154.95472282368894,0,0,0,66.60097293854908,139.91167402688353Z"></path><path d="M-71.96834683623156,147.83048339392255A164.4180487866856,164.4180487866856,0,0,1,-160.13852828535684,37.26857289219554L-155.66854073305194,36.24832740277672A159.83314992033644,159.83314992033644,0,0,0,-69.97901522640755,143.69959374124537Z"></path><path d="M-162.72096472928754,36.421999533309304A166.74733704750557,166.74733704750557,0,0,1,-130.8036100324855,-103.41706829582766L-124.74437485235698,-98.58498948269506A158.99735597992958,158.99735597992958,0,0,0,-155.16522204553993,34.69745057157278Z"></path><path d="M-133.64585540869885,-107.4743430976937A171.499122715551,171.499122715551,0,0,1,-0.6999970833369806,-171.4976941427696L-0.6999970833369726,-167.55138327766554A167.55284549710237,167.55284549710237,0,0,0,-130.56050533475488,-105.013858518337Z"></path></g><g fill="#00d3a9"><path d="M0.6999970833369911,-179.01384598824868A179.01521458083135,179.01521458083135,0,0,1,139.52221954850455,-112.16058712257164L137.81306296971917,-110.79758023355699A176.8291381834659,176.8291381834659,0,0,0,0.6999970833369846,-176.82775267132303Z"></path><path d="M139.59061592433454,-110.4244716625302A177.98624664867793,177.98624664867793,0,0,1,173.67818185416854,38.92291283953938L168.51170169065293,37.74369745665078A172.68694306281174,172.68694306281174,0,0,0,135.4474205199242,-107.1203835825731Z"></path><path d="M173.59784376171496,40.34057381943258A178.22338021370228,178.22338021370228,0,0,1,77.9583057366553,160.26876121524137L76.08483749058448,156.37846431647645A173.90551054508924,173.90551054508924,0,0,0,169.38819882458145,39.37974983303232Z"></path><path d="M77.10265370392145,161.71863883615143A179.158414134543,179.158414134543,0,0,1,-77.10265370392142,161.71863883615143L-74.38450321134167,156.07434117920596A172.89376591572434,172.89376591572434,0,0,0,74.3845032113417,156.07434117920596Z"></path><path d="M-76.71445283661333,157.68587405411566A175.35661421865842,175.35661421865842,0,0,1,-170.8029316652958,39.70265337193087L-160.13852828535684,37.26857289219554A164.4180487866856,164.4180487866856,0,0,0,-71.96834683623156,147.83048339392255Z"></path><path d="M-173.43794166123558,38.868079583216186A177.73983013993623,177.73983013993623,0,0,1,-139.39795824796462,-110.2708322924612L-130.8036100324855,-103.41706829582766A166.74733704750557,166.74733704750557,0,0,0,-162.72096472928754,36.421999533309304Z"></path><path d="M-136.66178827899415,-109.87946930441A175.35661421865842,175.35661421865842,0,0,1,-0.6999970833369676,-175.3552170718474L-0.6999970833369806,-171.4976941427696A171.499122715551,171.499122715551,0,0,0,-133.64585540869885,-107.4743430976937Z"></path></g><g fill="#ffd24d"><path d="M0.6999970833369923,-181.60242450022795A181.60377358490564,181.60377358490564,0,0,1,141.5460517240102,-113.77453942610137L139.52221954850455,-112.16058712257164A179.01521458083135,179.01521458083135,0,0,0,0.6999970833369911,-179.01384598824868Z"></path><path d="M142.41893380959317,-112.6799799113241A181.60377358490567,181.60377358490567,0,0,1,177.20503656991534,39.72789441353071L173.67818185416854,38.92291283953938A177.98624664867793,177.98624664867793,0,0,0,139.59061592433454,-110.4244716625302Z"></path><path d="M176.89350856041364,41.092787803512884A181.60377358490564,181.60377358490564,0,0,1,79.42501455468206,163.3144134584153L77.9583057366553,160.26876121524137A178.22338021370228,178.22338021370228,0,0,0,173.59784376171496,40.34057381943258Z"></path><path d="M78.16366339526384,163.92184816219455A181.60377358490564,181.60377358490564,0,0,1,-78.16366339526381,163.92184816219455L-77.10265370392142,161.71863883615143A179.158414134543,179.158414134543,0,0,0,77.10265370392145,161.71863883615143Z"></path><path d="M-79.42501455468205,163.3144134584153A181.60377358490564,181.60377358490564,0,0,1,-176.89350856041364,41.092787803512905L-170.8029316652958,39.70265337193087A175.35661421865842,175.35661421865842,0,0,0,-76.71445283661333,157.68587405411566Z"></path><path d="M-177.2050365699153,39.72789441353073A181.60377358490564,181.60377358490564,0,0,1,-142.41893380959317,-112.67997991132407L-139.39795824796462,-110.2708322924612A177.73983013993623,177.73983013993623,0,0,0,-173.43794166123558,38.868079583216186Z"></path><path d="M-141.54605172401023,-113.77453942610137A181.60377358490564,181.60377358490564,0,0,1,-0.6999970833369338,-181.60242450022795L-0.6999970833369676,-175.3552170718474A175.35661421865842,175.35661421865842,0,0,0,-136.66178827899415,-109.87946930441Z"></path></g></g><g><g text-anchor="middle" transform="rotate(-64.28571428571428)translate(140,0)"><line x2="-5" stroke="#000"></line><text transform="rotate(90)translate(0,16)">Jan</text></g><g text-anchor="middle" transform="rotate(-12.857142857142847)translate(140,0)"><line x2="-5" stroke="#000"></line><text transform="rotate(90)translate(0,16)">Feb</text></g><g text-anchor="middle" transform="rotate(38.571428571428555)translate(140,0)"><line x2="-5" stroke="#000"></line><text transform="rotate(-90)translate(0,-9)">Mar</text></g><g text-anchor="middle" transform="rotate(90)translate(140,0)"><line x2="-5" stroke="#000"></line><text transform="rotate(-90)translate(0,-9)">Apr</text></g><g text-anchor="middle" transform="rotate(141.42857142857142)translate(140,0)"><line x2="-5" stroke="#000"></line><text transform="rotate(-90)translate(0,-9)">May</text></g><g text-anchor="middle" transform="rotate(192.85714285714283)translate(140,0)"><line x2="-5" stroke="#000"></line><text transform="rotate(90)translate(0,16)">Jun</text></g><g text-anchor="middle" transform="rotate(244.28571428571428)translate(140,0)"><line x2="-5" stroke="#000"></line><text transform="rotate(90)translate(0,16)">Jul</text></g></g><g text-anchor="middle"><g><circle fill="none" stroke="#000" r="149.25141914251782"></circle><text y="-149.25141914251782" dy="0.35em" fill="none" stroke="#fff" stroke-width="5" stroke-linejoin="round">20%</text><text y="-149.25141914251782" dy="0.35em">20%</text></g><g><circle fill="none" stroke="#000" r="157.96193285760677"></circle><text y="-157.96193285760677" dy="0.35em" fill="none" stroke="#fff" stroke-width="5" stroke-linejoin="round">40%</text><text y="-157.96193285760677" dy="0.35em">40%</text></g><g><circle fill="none" stroke="#000" r="166.21660069970932"></circle><text y="-166.21660069970932" dy="0.35em" fill="none" stroke="#fff" stroke-width="5" stroke-linejoin="round">60%</text><text y="-166.21660069970932" dy="0.35em">60%</text></g><g><circle fill="none" stroke="#000" r="174.0802816640131"></circle><text y="-174.0802816640131" dy="0.35em" fill="none" stroke="#fff" stroke-width="5" stroke-linejoin="round">80%</text><text y="-174.0802816640131" dy="0.35em">80%</text></g><g><circle fill="none" stroke="#000" r="181.60377358490564"></circle><text y="-181.60377358490564" dy="0.35em" fill="none" stroke="#fff" stroke-width="5" stroke-linejoin="round">100%</text><text y="-181.60377358490564" dy="0.35em">100%</text></g></g><g><g transform="translate(-40,-33)"><rect width="18" height="18" stroke="rgb(74, 152, 0)" fill="#69d900" rx="2"></rect><text x="24" y="9" dy="0.35em">Referral</text></g><g transform="translate(-40,-11)"><rect width="18" height="18" stroke="rgb(0, 114, 152)" fill="#00a3d9" rx="2"></rect><text x="24" y="9" dy="0.35em">Payments</text></g><g transform="translate(-40,11)"><rect width="18" height="18" stroke="rgb(0, 148, 118)" fill="#00d3a9" rx="2"></rect><text x="24" y="9" dy="0.35em">Adjustments</text></g><g transform="translate(-40,33)"><rect width="18" height="18" stroke="rgb(179, 147, 54)" fill="#ffd24d" rx="2"></rect><text x="24" y="9" dy="0.35em">Write-off</text></g></g></g></svg></div>
    </div>

<svg width="960" height="960" font-family="sans-serif" font-size="10"></svg>


<script>

var data = [
  {
    "month": "Jan",
    "Referral": 90,
    "Payments": 60,
    "Adjustments": 10,
    "Write-off": 12
  },
  {
    "month": "Feb",
    "Referral": 80,
    "Payments": 30,
    "Adjustments": 20,
    "Write-off": 14
  },
  {
    "month": "Mar",
    "Referral": 70,
    "Payments": 70,
    "Adjustments": 20,
    "Write-off": 16
  },
  {
    "month": "Apr",
    "Referral": 60,
    "Payments": 80,
    "Adjustments": 30,
    "Write-off": 12
  },
  {
    "month": "May",
    "Referral": 80,
    "Payments": 20,
    "Adjustments": 50,
    "Write-off": 30
  },
  {
    "month": "Jun",
    "Referral": 90,
    "Payments": 40,
    "Adjustments": 60,
    "Write-off": 22
  },
  {
    "month": "Jul",
    "Referral": 95,
    "Payments": 15,
    "Adjustments": 15,
    "Write-off": 25
  }
]

function radialStackedBar(config, data) {


    var elementId = config.chartSetting.elementId;

        var height = config.chartSetting.height
        var width = config.chartSetting.width

        var margin = config.chartSetting.margin,
            width = width - margin.left - margin.right,
            height = height - margin.top - margin.bottom,
            colorArray = config.chartSetting.colorArray;    

		var columns = config.chartSetting.columns


var innerRadius = 140,
    outerRadius = Math.min(width, height)/2.12;

var g = d3.select("#" + elementId).append("svg")
		 .attr("viewBox", "0 0 "+(width + margin.left + margin.right)+' '+(height + margin.top + margin.bottom))
			.append("g")
          	.attr("transform", "translate(" + (width+margin.left) / 2 + "," + (height+margin.top)/2 + ")");

      data.forEach(function(d) {
			for (i = 1, t = 0; i < columns.length; ++i)
        	t += d[columns[i]] = +d[columns[i]];
		  d.total = t;
      });

		var x = d3.scaleBand()
    .range([0, 2 * Math.PI])
    .align(0);

var y = d3.scaleRadial()
    .range([innerRadius, outerRadius]);

var z = d3.scaleOrdinal()
    .range(colorArray);
  
  //data.sort(function(a, b) { return b[data.columns[1]] / b.total - a[data.columns[1]] / a.total; });
  x.domain(data.map(function(d) { return d.month; }));
  z.domain(columns);

  g.append("g")
    .selectAll("g")
    .data(d3.stack()
        .keys(columns)
        .offset(d3.stackOffsetExpand)
        (data))
    .enter().append("g")
      .attr("fill", function(d) { return z(d.key); })
    .selectAll("path")
    .data(function(d) { return d; })
    .enter().append("path")
      .attr("d", d3.arc()
          .innerRadius(function(d) { return y(d[0]); })
          .outerRadius(function(d) { return y(d[1]); })
          .startAngle(function(d) { return x(d.data.month); })
          .endAngle(function(d) { return x(d.data.month) + x.bandwidth(); })
          .padAngle(0.01)
          .padRadius(innerRadius));

  var label = g.append("g")
    .selectAll("g")
    .data(data)
    .enter().append("g")
      .attr("text-anchor", "middle")
      .attr("transform", function(d) { return "rotate(" + ((x(d.month) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")translate(" + innerRadius + ",0)"; });

  label.append("line")
      .attr("x2", -5)
      .attr("stroke", "#000");

  label.append("text")
      .attr("transform", function(d) { return (x(d.month) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) < Math.PI ? "rotate(90)translate(0,16)" : "rotate(-90)translate(0,-9)"; })
      .text(function(d) { return d.month; });

  var yAxis = g.append("g")
      .attr("text-anchor", "middle");

  var yTick = yAxis
    .selectAll("g")
    .data(y.ticks(5).slice(1))
    .enter().append("g");

  yTick.append("circle")
      .attr("fill", "none")
      .attr("stroke", "#000")
      .attr("r", y);

  yTick.append("text")
      .attr("y", function(d) { return -y(d); })
      .attr("dy", "0.35em")
      .attr("fill", "none")
      .attr("stroke", "#fff")
      .attr("stroke-width", 5)
      .attr("stroke-linejoin", "round")
      .text(y.tickFormat(5, "%"));

  yTick.append("text")
      .attr("y", function(d) { return -y(d); })
      .attr("dy", "0.35em")
      .text(y.tickFormat(5, "%"));

  var legend = g.append("g")
    .selectAll("g")
    .data(columns)
    .enter().append("g")
      .attr("transform", function(d, i) { return "translate(-40," + (i - (columns.length - 1) / 2) * 22 + ")"; });

  legend.append("rect")
  .attr("width", 18)
  .attr("height", 18)
  .attr("stroke", function(d, i) { return d3.rgb(z(i)).darker() })
  .attr("fill", function(d, i) { return z(i) })
  .attr("rx", 2)  

  legend.append("text")
      .attr("x", 24)
      .attr("y", 9)
      .attr("dy", "0.35em")
      .text(function(d) { return d; });

}
var config = {
    chartSetting : {
        elementId : "chart1",
        adaptive: "true",
        width : 960,
        height : 425,
        margin : { 
            top: 20,
            right: 20,
            bottom: 20,
            left: 20
        },
        colorArray : ["#69d900", "#00a3d9", "#00d3a9", "#ffd24d"],
       columns : ["Referral", "Payments","Adjustments","Write-off"],
       
    }
    
}    
radialStackedBar(config, data);
  
</script></body></html>